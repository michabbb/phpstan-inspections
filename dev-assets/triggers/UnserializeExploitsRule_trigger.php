<?php declare(strict_types=1);

/**
 * Trigger script for UnserializeExploitsRule
 * Tests various unserialize() vulnerabilities
 */

// Test 1: Missing second argument (should trigger error)
$data1 = 'some_serialized_data';
$result1 = unserialize($data1); // ERROR: Missing allowed_classes parameter

// Test 2: Empty array as second argument (should trigger error)
$data2 = 'some_serialized_data';
$result2 = unserialize($data2, []); // ERROR: Empty array means no classes allowed

// Test 3: True as second argument (should trigger error)
$data3 = 'some_serialized_data';
$result3 = unserialize($data3, true); // ERROR: True allows all classes (insecure)

// Test 4: Untrusted source - $_GET (should trigger exploit warning)
$result4 = unserialize($_GET['data']); // ERROR: Untrusted source

// Test 5: Untrusted source - $_POST (should trigger exploit warning)
$result5 = unserialize($_POST['payload']); // ERROR: Untrusted source

// Test 6: Untrusted source - file_get_contents() (should trigger exploit warning)
$externalData = file_get_contents('http://example.com/data');
$result6 = unserialize($externalData); // ERROR: Untrusted source

// Test 7: Untrusted source - base64_decode() (should trigger exploit warning)
$encodedData = base64_decode($_GET['encoded']);
$result7 = unserialize($encodedData); // ERROR: Untrusted source

// Test 8: Untrusted source - urldecode() (should trigger exploit warning)
$urlData = urldecode($_REQUEST['data']);
$result8 = unserialize($urlData); // ERROR: Untrusted source

// Test 9: Array access to untrusted source (should trigger exploit warning)
$result9 = unserialize($_FILES['upload']['data']); // ERROR: Untrusted source

// Test 10: Proper usage (should NOT trigger errors)
$trustedData = 'trusted_serialized_data';
$allowedClasses = ['MyClass', 'AnotherClass'];
$result10 = unserialize($trustedData, $allowedClasses); // OK: Proper usage

// Test 11: Complex untrusted source chain (should trigger exploit warning)
$complexData = base64_decode(urldecode($_GET['complex']));
$result11 = unserialize($complexData); // ERROR: Multiple untrusted sources